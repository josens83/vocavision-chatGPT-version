// ============================================
// VocaVision - Prisma Schema Extension for Image Generation
// 이 내용을 기존 schema.prisma의 VocaMedia 모델에 추가/수정하세요
// ============================================

// ---------------------------------------------
// VocaMedia 모델 확장 (기존 모델 수정)
// ---------------------------------------------

/*
model VocaMedia {
  id          String   @id @default(uuid())
  contentId   String
  content     VocaContent @relation(fields: [contentId], references: [id], onDelete: Cascade)

  // 기본 필드
  type        MediaType   // 'gif' | 'image' | 'video'
  url         String
  thumbnailUrl String?
  caption     String?
  altText     String?
  source      String?     // 'ai-generated' | 'uploaded' | 'external'
  order       Int         @default(0)

  // WHISK/AI 생성 관련 필드 추가
  whiskPrompt    String?   @db.Text    // 이미지 생성에 사용된 프롬프트
  whiskStyle     String?               // 사용된 스타일 (cartoon, anime, etc.)
  whiskSeed      Int?                  // 재현용 시드값
  whiskModel     String?               // 사용된 모델 (stability-sdxl, dall-e-3)
  whiskMetadata  Json?                 // 추가 메타데이터 (steps, cfg_scale 등)

  // 관리 필드
  isActive    Boolean  @default(true)
  generatedAt DateTime?              // AI 생성 시점
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([contentId])
  @@index([type])
  @@index([source])
  @@index([whiskStyle])
}

enum MediaType {
  gif
  image
  video
}
*/

// ---------------------------------------------
// ImageGenerationJob 모델 (새로 추가)
// 배치 이미지 생성 작업 추적용
// ---------------------------------------------

/*
model ImageGenerationJob {
  id          String   @id @default(uuid())

  // 작업 정보
  status      ImageJobStatus @default(PENDING)
  totalWords  Int
  completed   Int       @default(0)
  failed      Int       @default(0)

  // 설정
  style       String?   // 사용할 스타일
  size        String?   // 이미지 크기
  regenerate  Boolean   @default(false)

  // 입력/결과
  wordIds     String[]  // 대상 단어 ID 목록
  results     Json?     // 생성 결과 상세
  errorLog    Json?     // 에러 로그

  // 타이밍
  startedAt   DateTime?
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // 생성자
  createdBy   String?

  @@index([status])
  @@index([createdAt])
}

enum ImageJobStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}
*/

// ---------------------------------------------
// ImageGenerationLog 모델 (새로 추가)
// 개별 이미지 생성 로그용
// ---------------------------------------------

/*
model ImageGenerationLog {
  id          String   @id @default(uuid())

  // 연결
  wordId      String
  word        VocaWord @relation(fields: [wordId], references: [id])
  jobId       String?  // 배치 작업 ID (있는 경우)

  // 결과
  success     Boolean
  imageUrl    String?
  thumbnailUrl String?

  // 생성 정보
  prompt      String?   @db.Text
  style       String?
  model       String?
  seed        Int?

  // 에러 (실패 시)
  errorCode   String?
  errorMessage String?

  // 비용/시간 추적
  durationMs  Int?      // 생성 소요 시간
  apiCost     Float?    // 예상 API 비용

  // 타이밍
  createdAt   DateTime  @default(now())

  @@index([wordId])
  @@index([jobId])
  @@index([success])
  @@index([createdAt])
}
*/

// ---------------------------------------------
// Migration SQL (참고용)
// ---------------------------------------------

/*
-- VocaMedia 테이블에 WHISK 필드 추가
ALTER TABLE "VocaMedia"
ADD COLUMN "whiskPrompt" TEXT,
ADD COLUMN "whiskStyle" VARCHAR(50),
ADD COLUMN "whiskSeed" INTEGER,
ADD COLUMN "whiskModel" VARCHAR(50),
ADD COLUMN "whiskMetadata" JSONB,
ADD COLUMN "generatedAt" TIMESTAMP;

-- 인덱스 추가
CREATE INDEX "VocaMedia_whiskStyle_idx" ON "VocaMedia"("whiskStyle");
CREATE INDEX "VocaMedia_source_idx" ON "VocaMedia"("source");

-- ImageGenerationJob 테이블 생성
CREATE TABLE "ImageGenerationJob" (
  "id" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  "status" VARCHAR(20) NOT NULL DEFAULT 'PENDING',
  "totalWords" INTEGER NOT NULL,
  "completed" INTEGER NOT NULL DEFAULT 0,
  "failed" INTEGER NOT NULL DEFAULT 0,
  "style" VARCHAR(50),
  "size" VARCHAR(20),
  "regenerate" BOOLEAN NOT NULL DEFAULT false,
  "wordIds" TEXT[] NOT NULL,
  "results" JSONB,
  "errorLog" JSONB,
  "startedAt" TIMESTAMP,
  "completedAt" TIMESTAMP,
  "createdAt" TIMESTAMP NOT NULL DEFAULT NOW(),
  "updatedAt" TIMESTAMP NOT NULL DEFAULT NOW(),
  "createdBy" VARCHAR(255)
);

CREATE INDEX "ImageGenerationJob_status_idx" ON "ImageGenerationJob"("status");
CREATE INDEX "ImageGenerationJob_createdAt_idx" ON "ImageGenerationJob"("createdAt");

-- ImageGenerationLog 테이블 생성
CREATE TABLE "ImageGenerationLog" (
  "id" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  "wordId" UUID NOT NULL REFERENCES "VocaWord"("id") ON DELETE CASCADE,
  "jobId" UUID,
  "success" BOOLEAN NOT NULL,
  "imageUrl" TEXT,
  "thumbnailUrl" TEXT,
  "prompt" TEXT,
  "style" VARCHAR(50),
  "model" VARCHAR(50),
  "seed" INTEGER,
  "errorCode" VARCHAR(50),
  "errorMessage" TEXT,
  "durationMs" INTEGER,
  "apiCost" DECIMAL(10, 6),
  "createdAt" TIMESTAMP NOT NULL DEFAULT NOW()
);

CREATE INDEX "ImageGenerationLog_wordId_idx" ON "ImageGenerationLog"("wordId");
CREATE INDEX "ImageGenerationLog_jobId_idx" ON "ImageGenerationLog"("jobId");
CREATE INDEX "ImageGenerationLog_success_idx" ON "ImageGenerationLog"("success");
CREATE INDEX "ImageGenerationLog_createdAt_idx" ON "ImageGenerationLog"("createdAt");
*/
